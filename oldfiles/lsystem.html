<!--
lsystem.html
Bennett Chang
CSCI-510 
-->

<html>
<head>
    <title>CSCI-510: L-System Example + Assignment 2</title>

    <!-- vertex Shader -->
    <script id="shader" type="wgsl">
        struct VertexOutput {
            @builtin(position) aVertexPosition: vec4<f32>,
            @location(0) color: vec3<f32>, // added output color to fragment shader
        };

        struct UniformStruct {
             theta : vec3<f32>,
             scale : f32
        };

        @group(0) @binding(0) var<uniform> uniformStruct : UniformStruct;

        @vertex
        fn vs_main(
            @location(0) inPos: vec3<f32>,
            @location(1) inColor: vec3<f32> // added input color from a new buffer
        ) -> VertexOutput {
            var out: VertexOutput;
            // Compute the sines and cosines of each rotation
            // about each axis - must be converted into radians first
            var c = cos(  uniformStruct.theta );
            var s = sin(  uniformStruct.theta );

            // translation matrix
            var trans = mat4x4<f32> ( 1.0,  0.0,  0.0,  0.0,
                             0.0,  1.0,  0.0,  0.0,
                             0.0, 0.0,  1.0,  0.0,
                             0.0,  0.0, 0.0,  1.0 );
            // scale matrix
            var scale = mat4x4<f32> ( uniformStruct.scale,  0.0,  0.0,  0.0,
                             0.0,  uniformStruct.scale,  0.0,  0.0,
                             0.0, 0.0,  uniformStruct.scale,  0.0,
                             0.0,  0.0,  0.0,  1.0 );
            // rotation matrices
            var rx = mat4x4<f32> ( 1.0,  0.0,  0.0,  0.0,
                             0.0,  c.x,  s.x,  0.0,
                             0.0, -s.x,  c.x,  0.0,
                             0.0,  0.0,  0.0,  1.0 );

            var ry = mat4x4<f32> ( c.y,  0.0, -s.y,  0.0,
                             0.0,  1.0,  0.0,  0.0,
                             s.y,  0.0,  c.y,  0.0,
                             0.0,  0.0,  0.0,  1.0 );

            var rz = mat4x4<f32> ( c.z,  s.z,  0.0,  0.0,
                            -s.z,  c.z,  0.0,  0.0,
                             0.0,  0.0,  1.0,  0.0,
                             0.0,  0.0,  0.0,  1.0 );


            out.aVertexPosition =  trans * rz * ry * rx * scale * vec4<f32>(inPos.x, inPos.y, inPos.z, 1);
            out.color = inColor; // added color pass
            return out;
           }

           @fragment
           fn fs_main(in: VertexOutput) -> @location(0) vec4<f32> {
                // MODIFIED: Use the incoming vertex color instead of a fixed color
                return vec4<f32>(in.color, 1.0);
           }

    </script>
   
    <!-- include the shape creation functions -->
    <script type="text/javascript" src="./cgIShape.js"></script>

    <!-- include the main tesselation functions -->
    <script type="text/javascript" src="./lsystemMain.js"></script>

    <!-- keyboard functions -->
    <script type="text/javascript">

        function gotKey(event) {

            var key = event.key;

            //  incremental rotation
            if (key == 'x')
                angles[0] -= angleInc;
            else if (key == 'y')
                angles[1] -= angleInc;
            else if (key == 'z')
                angles[2] -= angleInc;
            else if (key == 'X')
                angles[0] += angleInc;
            else if (key == 'Y')
                angles[1] += angleInc;
            else if (key == 'Z')
                angles[2] += angleInc;

            // scale control
            else if (key == '+') {
                scale *= 1.0/scaleInc;
            }
            else if (key == '-') {
                scale *= scaleInc;
            }
            // reset
            else if (key == 'r' || key == 'R') {
                angles[0] = anglesReset[0];
                angles[1] = anglesReset[1];
                angles[2] = anglesReset[2];
                scale = scaleReset;
            }
            else if (key == 'c') {
                if (iterations > 1) {
                    iterations -= 1;
                }
                createLSystem('plant'); // specify which L-System to create with 'plant'
            }
            else if (key == 'C') {
                iterations += 1;
                createLSystem('plant');
            }
            // added for second L-System (Sierpinski Triangle)
            else if (key == 'f') {
                if (iterations2 > 1) {
                    iterations2 -= 1;
                }
                createLSystem('sierpinski');
            }
            else if (key == 'F') {
                iterations2 += 1;
                createLSystem('sierpinski');
            }

            draw();
        }

    </script>

    <script type="text/javascript">
        // Call init once the webpage has loaded
        window.onload = init;
    </script>
</head>

<body>
  <h1>CSCI-510: L-System Example + Assignment 2</h1>
  <table>
      <tr>
          <td><canvas id="webgpu" width="800" height="800">
            Your browser does not support the HTML5 canvas element.
          </canvas></td>
          
          <td>
              <h3>Controls</h3>
              
              <table border="1">
                  <tbody>
                      <tr>
                          <td>x, y, z</td>
                          <td>Rotate the current shape forward about the x, y, or z axis</td>
                      </tr>
                      <tr>
                          <td>X, Y, Z</td>
                          <td>Rotate the current shape backward about the x, y, or z axis</td>
                      </tr>
                      <tr>
                          <td>+</td>
                          <td>Positive scale (zoom in)</td>
                      </tr>
                      <tr>
                          <td>-</td>
                          <td>Negative scale (zoom out)</td>
                      </tr>
                      <tr>
                          <td>c</td>
                          <td>Recreate l-system 1 with n-1 iterations</td>
                      </tr>
                      <tr>
                          <td>C</td>
                          <td>Recreate l-system 1 with n+1 iterations</td>
                      </tr>
                      <tr>
                          <td>f</td>
                          <td>Recreate l-system 2 with n-1 iterations</td>
                      </tr>
                      <tr>
                          <td>F</td>
                          <td>Recreate l-system 2 with n+1 iterations</td>
                      </tr>
                      <tr>
                          <td>r, R</td>
                          <td>Reset the figure to its original orientation and scale</td>
                      </tr>
                  </tbody>
              </table>
              
          </td>
      </tr>
  </table>


  
</body>
</html>